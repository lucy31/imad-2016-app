<!doctype html>
<html>
  <head>
    <title>Signup</title>
    <meta name="viewport" contents="width=device-width, initial-scale=1"/>
      <link href="/ui/style.css" rel="stylesheet" />
    <style>
        .form-control {
            display: block;
            width: 100%;
            height: 34px;
            padding: 6px 12px;
                padding-top: 6px;
                padding-right: 12px;
                padding-bottom: 6px;
                padding-left: 12px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
                border-top-width: 1px;
                border-right-width: 1px;
                border-bottom-width: 1px;
                border-left-width: 1px;
                border-top-style: solid;
                border-right-style: solid;
                border-bottom-style: solid;
                border-left-style: solid;
                border-top-color: rgb(204, 204, 204);
                border-right-color: rgb(204, 204, 204);
                border-bottom-color: rgb(204, 204, 204);
                border-left-color: rgb(204, 204, 204);
                -moz-border-top-colors: none;
                -moz-border-right-colors: none;
                -moz-border-bottom-colors: none;
                -moz-border-left-colors: none;
                border-image-source: none;
                border-image-slice: 100% 100% 100% 100%;
                border-image-width: 1 1 1 1;
                border-image-outset: 0 0 0 0;
                border-image-repeat: stretch stretch;
            border-radius: 4px;
                border-top-left-radius: 4px;
                border-top-right-radius: 4px;
                border-bottom-right-radius: 4px;
                border-bottom-left-radius: 4px;
            -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
                box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.075) inset;
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
            -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
                transition-property: border-color, -webkit-box-shadow;
                transition-duration: 0.15s, 0.15s;
                transition-timing-function: ease-in-out, ease-in-out;
                transition-delay: 0s, 0s;
            -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
            transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
                transition-property: border-color, box-shadow;
                transition-duration: 0.15s, 0.15s;
                transition-timing-function: ease-in-out, ease-in-out;
                transition-delay: 0s, 0s;
        }
        
        .left-side{
            float: left;
            padding: 10px;
        }
        
        .right-side{
            float: right;
            padding: 10px;
        }
</style>
  </head>
  
  <body>

            <div class="left-side">
            <div class="container">
                <form>   
                    <input id="userid" class="form-control" placeholder="Username" autocomplete="on" type="text">
                    <br>
                    <input id="password" class="form-control" placeholder="Password" autocomplete="off" type="text">
                </form>
            </div>
            </div>
            <div class="right-side">
            <div class="container">
                <form>
                    <input id="name" class="form-control" placeholder="First Name" autocomplete="on" type="text">
                    <br>
                    <input id="email" class="form-control" placeholder="Email Address" autocomplete="on" type="emailAddress" onKeyUp="something()">
                    <label id="lblName"></label>
                    <br>
                    <input id="userid" class="form-control" placeholder="Choose a Username" autocomplete="off" type="text">
                    <br>
                    <input id="password" class="form-control" placeholder="Choose a Password" autocomplete="off" type="text">
                    <br>
                    <input id="password2" class="form-control" placeholder="Password" autocomplete="off" type="text">
                    <input type="submit" name="submit" value="Submit">  
                </form>

            </div>
            </div>
            
    <script>
      function val(emailAddress){        
      var pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
     return pattern.test(emailAddress);
   }
   function something(){
     emailAddress =  document.getElementById("email").value;
      if(val(emailAddress)){
    document.getElementById('lblName').innerHTML = 'Yes'
      }
      else{
    document.getElementById('lblName').innerHTML = 'No'
      }
   }

function validatesignup(){
	var name = document.getElementById('name');
	var email = document.getElementById('email');
	var userid = document.getElementById('userid');
	var password = document.getElementById('password');
	var password2 = document.getElementById('password2');	
	
	name.classList.remove("invalid");
    email.classList.remove("invalid");
    userid.classList.remove("invalid");
    password.classList.remove("invalid");
    password.classList.remove("invalid");

	var check = true;
	if(name.value === ""){
		name.classList.add("invalid");
		check = false;
	}
	if(email.value === ""){
		name.classList.add("invalid");
		check = false;
	}
	if(userid.value === ""){
		name.classList.add("invalid");
		check = false;
	}
	if(password.value === ""){
		name.classList.add("invalid");
		check = false;
	}
	if(password2.value === ""){
		name.classList.add("invalid");
		check = false;
	}	
    if(password.value !== "" && password2.value !== "" && password2.value !== password.value){
        password.classList.add("invalid");
        password2.classList.add("invalid");
        alert("Passwords don't match");
        check = false;
    }	
	if(password.value !== ""){
        if(password.value.length <= 4 || password.value.length >= 15){
            password.classList.add("invalid");
            alert("Password length should be between 4 to 15 characters");
            check = false;
        }
    }
	if(check){
        name.classList.remove("invalid");
        userid.classList.remove("invalid");
        email.classList.remove("invalid");
        password.classList.remove("invalid");
        password2.classList.remove("invalid");
        return true;
    }
    else{
        return false;
    }	
}

var signup = document.getElementById('up');
signup.onclick = function(){
    var name = document.getElementById('name').value;
    var email = document.getElementById('email').value;
    var userid = document.getElementById('userid').value;
    var password = document.getElementById('password').value;
    if(validatesignup() === true){
            var request = new XMLHttpRequest();	
			request.onreadystatechange = function () {
            if (request.readyState === XMLHttpRequest.DONE) {
                if (request.status === 200) {
                      signup.value = 'Sucess!';
                } else if (request.status === 403) {
                      signup.value = 'Submit';
                      var c = confirm("User already Registered\n If you have forget password click on \"OK\" else \"Cancel\"");
                      if(c === true){
                          var con = prompt("Enter \"CONFIRM\" to override the password"); 
                          if(con === "confirm" || con === "CONFIRM"){
                                updateUser(fname,lname,email,password);
                          }
                      }
                } else if (request.status === 500) {
                    alert('Something went wrong on the server');
                      signup.value = 'Login';
                  } else {
                    alert('Something went wrong on the server');
                    submit.value = 'Login';
                    }
                }  
            };
        
            request.open('POST', '/signup', true);
            request.setRequestHeader('Content-Type', 'application/json');
            request.send(JSON.stringify({name: name, email: email, userid: userid, password: password}));  
            signup.value = 'Registering...';
        }
};
			
    </script>
        
  </body>
</html>